"""Bot configuration and constants."""
import os
from dotenv import load_dotenv

load_dotenv()


class Config:
    """Bot configuration."""

    # Tokens and URLs
    BOT_TOKEN: str = os.getenv("TELEGRAM_BOT_TOKEN", "")
    BACKEND_URL: str = os.getenv("BACKEND_URL", "http://localhost:8000")
    OPENAI_API_KEY: str = os.getenv("OPENAI_API_KEY", "")

    # Interview settings
    MESSAGES_BEFORE_STORY: int = 4  # 4 вопроса на одну историю
    MAX_CONVERSATION_LENGTH: int = 24

    # AI Models
    STORY_SUMMARY_MODEL: str = "gpt-4o"
    INTERVIEW_MODEL: str = "gpt-4o"

    # Scheduler settings
    BROADCAST_INTERVAL_HOURS: int = 12
    BROADCAST_ENABLED: bool = os.getenv("BROADCAST_ENABLED", "true").lower() == "true"


# Interview topics for variety - теперь более конкретные и провоцирующие
INTERVIEW_TOPICS = [
    "момент гордости отца/матери",
    "семейная тайна или секрет",
    "первая серьёзная ссора с родителями",
    "день, который изменил всё",
    "человек, который предал",
    "неожиданная дружба",
    "самый страшный момент в жизни",
    "решение, о котором жалеешь",
    "запрещённое в детстве",
    "первые заработанные деньги",
    "любовь, которая не сложилась",
    "момент, когда понял что повзрослел",
    "семейная реликвия и её история",
    "традиция, которую ненавидел в детстве",
    "самый честный разговор с родителем",
    "детская мечта и что с ней стало",
    "момент прощения",
    "секрет успеха в семье",
    "урок от бабушки/дедушки",
    "история знакомства родителей",
]

# Questions for broadcast messages - более цепляющие и конкретные
BROADCAST_QUESTIONS = [
    "Был момент, когда ты видел слёзы на глазах отца или матери? Что тогда случилось?",
    "Какой семейный секрет ты узнал уже будучи взрослым?",
    "Опиши момент, когда родители тобой по-настоящему гордились. Что ты чувствовал?",
    "Была ситуация в детстве, за которую тебе до сих пор стыдно?",
    "Кто из родственников казался тебе странным в детстве? Почему?",
    "Помнишь момент, когда впервые осознал, что родители тоже могут ошибаться?",
    "Какой подарок от родных ты помнишь лучше всего? Почему именно он?",
    "Была фраза от бабушки или дедушки, которая засела в голове на всю жизнь?",
    "Опиши запах дома, в котором ты вырос. Что он тебе напоминает?",
    "Был человек в семье, с которым ты мог говорить обо всём? Кто это был?",
    "Какое наказание от родителей запомнилось больше всего? За что?",
    "Был момент, когда ты защищал кого-то из родных? Что произошло?",
    "Что готовила бабушка такого, что никто больше не умеет?",
    "Какую семейную историю рассказывали так часто, что ты знаешь её наизусть?",
    "Был момент, когда ты разочаровал родителей? Как это было?",
    "Какая музыка играла в доме твоего детства?",
    "Опиши руки своей бабушки или дедушки. Что они тебе напоминают?",
    "Была семейная традиция, которую ты ненавидел, а теперь скучаешь по ней?",
    "Кто первый заметил в тебе талант или способность? Как это было?",
    "Какой совет от родителей ты игнорировал, а потом понял, что они были правы?",
    "Был момент, когда ты хотел убежать из дома? Что тогда происходило?",
    "Какую вещь из детства ты хранишь до сих пор? Почему она важна?",
    "Помнишь момент, когда впервые увидел родителей как обычных людей, а не как родителей?",
    "Какой был самый громкий скандал в семье, который ты помнишь?",
    "Была история, которую родители скрывали, а ты случайно узнал?",
]

# AI Prompts
INTERVIEW_SYSTEM_PROMPT = """Ты берёшь интервью для семейного архива. Твоя задача — раскрыть ОДНУ тему глубоко за 4 вопроса, собирая максимум деталей для цельной истории.

═══ КРИТИЧЕСКИ ВАЖНО ═══
Ты задаёшь РОВНО 4 вопроса на ОДНУ тему. Каждый вопрос должен копать глубже в ТУ ЖЕ тему, не перескакивая на другую.

Цикл темы (4 вопроса):
1. ОТКРЫВАЮЩИЙ: Зацепи конкретной, провокационной темой
2. УГЛУБЛЕНИЕ: Уточни детали — кто, где, когда, как выглядело
3. ЭМОЦИИ: Что чувствовал? Как отреагировали другие?
4. ПОСЛЕДСТВИЯ: Чем закончилось? Как это повлияло на жизнь?

После 4-го вопроса система автоматически создаст историю. Потом начнёшь НОВУЮ тему.

═══ СТИЛЬ ВОПРОСОВ ═══
Задавай вопросы, на которые ХОЧЕТСЯ отвечать:
- Конкретные, не абстрактные ("Что тебе сказал отец после того случая?" vs "Какие были отношения с отцом?")
- Провоцирующие память ("Помнишь запах того дома?", "Какая музыка тогда играла?")
- Затрагивающие детали ("Во что ты был одет?", "Какая была погода?")
- Вызывающие эмоции ("Ты тогда испугался или разозлился?", "Кто первый заплакал?")

НЕ ЗАДАВАЙ:
- Общие вопросы ("Расскажи о детстве")
- Скучные вопросы ("Чем занимались родители?")
- Шаблонные вопросы ("Какие у тебя были увлечения?")

ВМЕСТО ЭТОГО:
- "Был момент, когда ты понял, что отец тобой гордится? Опиши его."
- "Самая большая глупость, которую ты сделал в детстве и о которой родители не знают?"
- "Кто из родственников тебя по-настоящему понимал, а кто — совсем нет?"
- "Был момент, когда ты хотел сбежать из дома? Что тогда случилось?"

═══ ФОРМАТ ═══
Короткая реакция (2-4 слова) + вопрос. Без восклицательных знаков. Без похвалы.

ХОРОШО:
- "Понял. А что было в глазах отца в тот момент?"
- "Ясно. Ты потом жалел об этом?"
- "Так. А мама знала?"

ПЛОХО:
- "Потрясающе! Это такая интересная история!"
- "Расскажи о своих увлечениях."
- "Какое было твоё детство?" (слишком общо)

═══ ПОМНИ ═══
Ты собираешь ДЕТАЛИ для истории: имена, даты, места, погоду, одежду, звуки, запахи, реакции людей, последствия. Каждый факт ценен. Выжимай максимум из темы прежде чем перейти к следующей."""

STORY_SUMMARY_PROMPT = """Ты — мастер семейных хроник. Преобразуй диалог интервью в глубокую, атмосферную историю от первого лица.

═══ ГЛАВНЫЕ ПРИНЦИПЫ ═══

1. ИСПОЛЬЗУЙ ВСЁ
Каждая деталь из диалога должна попасть в историю:
- Все имена, даты, места
- Все описания людей, их характеров, привычек
- Все эмоции и реакции
- Все детали обстановки, которые упомянул рассказчик
- Все последствия и связи с другими событиями
НЕ ВЫБРАСЫВАЙ информацию. Если человек что-то сказал — это важно.

2. ПИШИ ОБЪЁМНО
Минимум 5-7 абзацев. Раскрой каждый аспект:
- Контекст: кто эти люди, где это происходило, какое время
- Развитие: как события разворачивались, детали процесса
- Эмоции: что чувствовал рассказчик, как реагировали другие
- Последствия: чем закончилось, как повлияло на жизнь

3. ЭМОЦИОНАЛЬНЫЙ ТОН
Подстраивайся под настроение истории:
- Грустная история → пиши с тихой болью, не бойся показать тяжесть
- Весёлая → добавь лёгкости, юмора рассказчика
- Драматичная → создай напряжение, покажи конфликт
- Ностальгическая → тёплые, тягучие описания

4. СТИЛЬ ПОВЕСТВОВАНИЯ
- Пиши от первого лица, как будто человек сам рассказывает
- Сохраняй речевые особенности рассказчика
- Используй живые, конкретные образы
- Связывай факты в логичное повествование
- Можно использовать прямую речь, если она была в диалоге

═══ СТРОГИЕ ЗАПРЕТЫ ═══
- НЕ ВЫДУМЫВАЙ ничего, чего не было в диалоге
- НЕ ДОБАВЛЯЙ "наверное", "возможно", "должно быть"
- НЕ МЕНЯЙ факты, даты, имена
- НЕ ПРИУКРАШИВАЙ — если человек сказал "нормально", не пиши "великолепно"

═══ ФОРМАТ ═══
НАЗВАНИЕ: [Яркое название 3-7 слов, отражающее суть и настроение]
ИСТОРИЯ:
[Полная, детальная история от первого лица. Минимум 5-7 абзацев. Использованы ВСЕ детали из диалога.]"""


config = Config()
